window.Teal=window.Teal||{};class Gcianalytics{constructor(t){this.parent=t,this.loadStrategy=!1,this.parent.settings.gcianalytics.load&&!window.gciAnalytics?this.load():this.init(),this.eventQueue=[],this._resetmilestone();const e=()=>{for(document.removeEventListener("gciAnalyticsReady",e);this.eventQueue.length;){let t=this.eventQueue.shift();window.gciAnalytics.view(this._getVideoData(t))}};document.addEventListener("gciAnalyticsReady",e)}async load(){try{this.init(),await Teal.Utils.loadScript("tealplayer_gcianalytics",this.parent.settings.gcianalytics.scriptUrl)}catch(t){}}init(){this.parent.sm.subscribe(this,{EVENT:this._onEvent,META:this._onMetaChange,STATE:this._onStateChange})}_onStateChange(t){t.controller===this.parent.sm.controllers.VIDEO?this._onStateChangeVideo(t.state):t.controller===this.parent.sm.controllers.PREROLL&&this._onStateChangePreroll(t.state)}_onMetaChange(t){switch(t){case this.parent.sm._fullscreen.name:this._makeViewCall("video-resize")}}_onEvent(t){switch(t){case this.parent.sm.EVENTS.muteClick:this._makeViewCall("video-mute");break;case this.parent.sm.EVENTS.unmuteClick:this._makeViewCall("video-unmute");break;case this.parent.sm.EVENTS.skip:this._makeViewCall("video-ad-skip");break;case this.parent.sm.EVENTS.pauseClick:this._makeViewCall("video-pause");break;case this.parent.sm.EVENTS.playClick:this._makeViewCall("video-resume");break;case this.parent.sm.EVENTS.playBackError:break;case this.parent.sm.EVENTS.timeChange:this._trackMilestone()}}_onStateChangePreroll(t){switch(t){case this.parent.sm.states.DONE:break;case this.parent.sm.states.STARTED:this._makeViewCall("video-ad-start")}}_onStateChangeVideo(t){switch(t){case this.parent.sm.states.DONE:this._makeViewCall("video-complete"),this._resetmilestone();break;case this.parent.sm.states.STARTED:let e;e=this.parent.sm.playbackIndex>0?"video-continuous-play":"auto-first"===this.parent.settings.base.startedBy?"video-autoplay":"video-play",this._makeViewCall(e)}}_resetmilestone(){this.betweenmilestonetime=0,this.previousmilestonemark=0,this.currentmilestone="",this.milestone={10:{eventname:"10% progress",fired:!1},25:{eventname:"25% progress",fired:!1},50:{eventname:"50% progress",fired:!1},75:{eventname:"75% progress",fired:!1},95:{eventname:"95% progress",fired:!1}}}_trackMilestone(){let t=Math.floor(this.parent.elements.video.currentTime/this.parent.capiDuration*100);switch(t){case 10:case 25:case 50:case 75:case 95:this.milestone[t].fired||this._callmilestone(this.milestone[t]);break;default:this.currentmilestone=""}}_callmilestone(t){this.currentmilestone=t.eventname,t.fired=!0,this.betweenmilestonetime=(this.parent.elements.video.currentTime-this.previousmilestonemark).toFixed(0),this.previousmilestonemark=this.parent.elements.video.currentTime,this._makeViewCall("video-milestone")}_makeViewCall(t){window.gciAnalytics&&window.gciAnalytics.isReady?window.gciAnalytics.view(this._getVideoData(t)):this.eventQueue.push(t)}_getVideoData(t){return{"client-action":"video-milestone"===t?this.currentmilestone:this.parent._playbackState,"event-type":t,"content-type":"video","content-id":this.parent.data.id,"content-byline":this.parent.data.byline,"content-cst":this.parent.data.awsPath,"content-keywords":this.parent.data.keywords,"content-source":this.parent.data.origin,"content-ssts-section":this.parent.data.ssts?this.parent.data.ssts.section:"","content-ssts-subsection":this.parent.data.ssts?this.parent.data.ssts.subsection:"","content-ssts-subtopic":this.parent.data.ssts?this.parent.data.ssts.subtopic:"","content-ssts-topic":this.parent.data.ssts?this.parent.data.ssts.topic:"","content-keywords":this.parent.data.keywords,"content-video-3p-tracking-id":this.parent.data.gannettTracking,"content-video-ad-name":"video-ad-start"===t&&this.parent.ima.adData?this.parent.ima.adData.adId:"","content-video-duration":this.parent.capiDuration,"content-video-market-name":this.parent.data.propertyName,"content-video-name":this.parent.data.title,"content-video-play-status":this.parent._playbackState,"content-video-player-rail-state":"","content-video-player-type":"teal","content-video-provider":this.parent.data.origin,"content-video-size":"","content-video-seconds-watched":"video-milestone"===t?this.betweenmilestonetime:0,"content-video-type":this.parent.settings.base.placement.replace(/teal-/g,""),"page-experience-type":this.parent.settings.base.platform||"desktop"}}}window.Teal.Gcianalytics=Gcianalytics;