window.__tnt||(window.__tnt={}),"function"!=typeof NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),__tnt.video||(__tnt.video={}),__tnt.video.blox||(__tnt.video.blox={}),__tnt.video.plugins||(__tnt.video.plugins={}),__tnt.video.advertising||(__tnt.video.advertising=function(e){__tnt.log("No video ad callback configured.")}),"function"==typeof window.CustomEvent?(window.videoReady=new CustomEvent("tntVideoReady"),window.videoEnded=new CustomEvent("tntVideoEnded")):(window.videoReady=document.createEvent("Event"),window.videoEnded=document.createEvent("Event"),videoReady.initEvent("tntVideoReady",!0,!0,{}),videoEnded.initEvent("tntVideoEnded",!0,!0,{})),__tnt.video.mimetype=function(e){var t="video/mp4";return"string"==typeof e&&(null!=e.match(/\.flv/)?t="video/x-flv":null!=e.match(/\.m3u8/)&&(t="application/x-mpegURL",videojs.browser.IS_ANY_SAFARI&&(t="application/vnd.apple.mpegurl"))),t},__tnt.video.getMarker=function(e,t){__tnt.user.loggedIn&&e.el_.dataset.premium&&fetch(__tnt.scrubUrl("/tncms/video/get_marker?asset_id="+e.el_.dataset.uuid)).then(function(n){if(200!==n.status)return void __tnt.log("Error. Status Code: "+n.status);n.json().then(function(n){e.currentTime(n.seconds),__tnt.video.blox.players[e.id()].resumeAt=n.seconds,"function"==typeof t&&t(e,n)})}).catch(function(e){__tnt.log("Fetch Error: ",e)})},__tnt.video.setMarker=function(e){var t=Math.floor(e.currentTime()),n=new XMLHttpRequest;if(__tnt.user.loggedIn&&e.el_.dataset.premium&&!__tnt.video.blox.players[e.id()].adPlaying){if(e.remainingTime()<=15)return void __tnt.video.clearMarker(e);t&&(__tnt.video.blox.players[e.id()].reported_pos=t,n.open("post",__tnt.scrubUrl("/tncms/video/set_marker/")),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4===n.readyState&&200!==n.status&&__tnt.log("Request failed "+n.status)},n.send(encodeURI("asset_id="+e.el_.dataset.uuid+"&seconds="+t)))}},__tnt.video.videoDataEvent=function(e,t){var n="",i="",o="",d=Math.floor(e.currentTime()),a=Math.round(100-(e.el_.dataset.duration-d)/e.el_.dataset.duration*100),r=!1,l="false";if(e.el_.dataset.duration&&""!=e.el_.dataset.duration||(l="true",a=""),a>=5&&a<=10?(a=10,r=!0):a>=20&&a<=25?(a=25,r=!0):a>=45&&a<=50?(a=50,r=!0):a>=70&&a<=75?(a=75,r=!0):a>=95&&a<=100&&(a=100),"video_paused"==t)n="video_paused",i="video paused",o=e.el_.dataset.title+":"+e.el_.dataset.uuid,d=e.el_.dataset.duration/100*a;else if("video_resumed"==t)n="video_resumed",i="video resumed",o=e.el_.dataset.title+":"+e.el_.dataset.uuid,d=e.el_.dataset.duration/100*a;else if(d<=1)n="video_start",i="video start",o=e.el_.dataset.title+":"+e.el_.dataset.uuid,d=0;else if(100==a)n="video_complete",i="video ended",o=e.el_.dataset.title+":"+e.el_.dataset.uuid,d=e.el_.dataset.duration;else{if(!r)return;n="video_progress",i="video progress",o=a+"%:"+e.el_.dataset.title+":"+e.el_.dataset.uuid,d=e.el_.dataset.duration/100*a}var s=new CustomEvent("tntVideoData",{detail:{video_uuid:e.el_.dataset.uuid,video_title:e.el_.dataset.title,video_provider:e.el_.dataset.provider,video_duration:e.el_.dataset.duration,video_url:e.currentSrc(),video_current_time:Math.round(d),video_progress:a,visible:e.el_.dataset.visible}});dispatchEvent(s),console.log(s.detail);try{dataLayer.push({event:"tncms.event.trigger","tncms.event.trigger.category":"video","tncms.event.trigger.action":i,"tncms.event.trigger.label":o,"tncms.event.trigger.value":"1","tncms.event.trigger.name":n,"tncms.event.trigger.video_uuid":e.el_.dataset.uuid,"tncms.event.trigger.video_title":e.el_.dataset.title,"tncms.event.trigger.video_provider":e.el_.dataset.provider,"tncms.event.trigger.video_url":e.currentSrc(),"tncms.event.trigger.video_streaming":l,"tncms.event.trigger.video_duration":e.el_.dataset.duration,"tncms.event.trigger.video_current_time":Math.round(d),"tncms.event.trigger.video_percent":a,"tncms.event.trigger.visible":e.el_.dataset.visible})}catch(e){console.debug("%c dataLayer is not defined","color: #990000")}},__tnt.video.clearMarker=function(e){if(__tnt.user.loggedIn&&e.el_.dataset.premium){var t=new XMLHttpRequest;t.open("post",__tnt.scrubUrl("/tncms/video/clear_marker")),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4===t.readyState&&200!==t.status&&__tnt.log("Request failed "+t.status)},t.send(encodeURI("asset_id="+e.el_.dataset.uuid))}},__tnt.video.pause=function(e){var t=__tnt.video.blox.players[e.id()].playing;e.remainingTime()>.2&&e.currentTime()>.2&&t&&(__tnt.video.videoDataEvent(e,"video_paused"),__tnt.video.blox.players[e.id()].paused=!0)},__tnt.video.register=function(e){__tnt.video.blox.players||(__tnt.video.blox.players=[]),void 0===__tnt.video.blox.players[e.id()]&&(__tnt.video.blox.players.push(e.id()),__tnt.video.blox.players[e.id()]={src:e.currentSrc(),playing:!1,played:!1,playLogged:!1,paused:!1,stalled:0,lastFrame:0,endcard:!0,endcardDisplayed:!1,adPlaying:!1,resumeAt:0,activeTextTrack:null})},__tnt.video.decompose=function(e){var t=[];__tnt.video.blox.players.forEach(function(n){n!=e&&(t.push(n),t[n]=__tnt.video.blox.players[n])}),__tnt.video.blox.players=t},__tnt.video.callback||(__tnt.video.callback=function(e){var t=function(t){__tnt.video.blox.players[e.id()].played=!0;var n=document.getElementById(e.id()+"-engagement");if(__tnt.video.clearMarker(e),__tnt.log("Player - Ended - passed playing check"),__tnt.video.blox.players[e.id()].playing=!1,__tnt.video.blox.players[e.id()].playLogged=!1,n){if(__tnt.log("Player - Displaying end card"),__tnt.log("Player - Running engagement module"),n.querySelectorAll(".engagement-container .engagement-item").length)n.querySelectorAll(".engagement-container .engagement-item").length?(n.classList.remove("hide"),n.style.display="block"):(n.style.display="block",e.bigPlayButton.el().style.display="block",n.querySelect(".engagement-spinner").style.display="none");else{var i=e.id().replace("video-player-","");__tnt.engagement&&__tnt.engagement.assets.length&&i&&"function"==typeof __tnt.engagement.assets[i].populate()&&(e.bigPlayButton.el().style.display="none",e.controlBar.el().style.display="none",n.style.display="none",n.querySelector(".engagement-spinner").style.display="none",e.currentTime(0),e.trigger("loadstart"))}__tnt.video.blox.players[e.id()].endcardDisplayed=!0,n.querySelector(".endcard-replay a").addEventListener("click",function(){n.style.display="none",e.play()})}e.el().dispatchEvent(videoEnded)};__tnt.video.register(e),e.on("__tnt.video.initialize",function(t){__tnt.video.blox.players[e.id()].playing=!1,__tnt.video.blox.players[e.id()].paused=!1,__tnt.video.blox.players[e.id()].reported_pos=!1,__tnt.video.blox.players[e.id()].reported_percent=0,__tnt.video.getMarker(e);var n=function(t,n){t[0].isIntersecting?e.el_.dataset.visible="true":e.el_.dataset.visible="false"};new IntersectionObserver(n).observe(e.el_),t.target.closest(".tn-mediaplayer")&&t.target.closest(".tn-mediaplayer").dataset.autoAdvance&&setTimeout(function(){e.play()},100)}),e.on("timeupdate",function(t){var n=Math.floor(e.currentTime()),i=Math.round(100-(e.el_.dataset.duration-n)/e.el_.dataset.duration*100);i>=5&&i<=10?i=10:i>=20&&i<=25?i=25:i>=45&&i<=50?i=50:i>=70&&i<=75?i=75:i>=95&&i<=100&&(i=100),10!=i&&25!=i&&50!=i&&75!=i&&100!=i||__tnt.video.blox.players[e.id()].reported_percent<i&&(__tnt.video.videoDataEvent(e),__tnt.video.blox.players[e.id()].reported_percent=i),n%10==0&&n!=__tnt.video.blox.players[e.id()].reported_pos&&(__tnt.video.blox.players[e.id()].reported_pos=n,__tnt.video.setMarker(e))}),e.on("play",function(t){var n=__tnt.video.blox.players[e.id()].playing,i=__tnt.video.blox.players[e.id()].paused,o=e.id().replace("video-player-",""),d=document.getElementById(e.id()+"-engagement"),a=__tnt.video.blox.players[e.id()].endcardDisplayed;if(__tnt.video.setMarker(e),i)__tnt.video.videoDataEvent(e,"video_resumed"),__tnt.video.blox.players[e.id()].paused=!1;else if(!n){if(__tnt.video.blox.players[e.id()].playing=!0,__tnt.video.blox.players.length>1)for(var r=0;r<__tnt.video.blox.players.length;r++){var l=__tnt.video.blox.players[r];__tnt.video.blox.players[l]&&e.id()!=l&&__tnt.video.blox.players[l].playing&&videojs(l)&&videojs(l).pause()}e.contentEl().querySelector(".vjs-loading-spinner").style.display="none",e.posterImage.el().style.display="none",__tnt.video.blox.players[e.id()].playLogged||(__tnt.video.blox.players[e.id()].playLogged=!0,__tnt.video.videoDataEvent(e)),e.contentEl()&&d&&e.contentEl().appendChild(d),d&&__tnt.engagement&&!a&&(__tnt.log("Player - On Play - Pre-populating end card"),__tnt.engagement.assets&&__tnt.engagement.assets[o]&&"function"==typeof __tnt.engagement.assets[o].populate()&&__tnt.engagement.assets[o].populate()),a&&(document.getElementById(e.id()+"-engagement").style.display="none")}}),e.on("pause",function(t){"true"!=e.el().closest(".tnt-video-container").getAttribute("data-live")||videojs.browser.IS_IOS?(__tnt.video.pause(e),__tnt.video.blox.players[e.id()].playing=!1):e.play()}),e.on("fullscreenchange",function(t){e.isFullscreen()?e.el().classList.add("is-fullscreen"):e.el().classList.remove("is-fullscreen")}),e.tech_.on("ended",t),e.on("ended",t),e.trigger("__tnt.video.initialize")}),__tnt.video.handleTags=function(e,t){for(var n=[],i={fluid:!0,plugins:__tnt.video.plugins,crossorigin:"anonymous",html5:{nativeTextTracks:!1,nativeAudioTracks:!1,nativeVideoTracks:!1,hls:{overrideNative:!0,handleManifestRedirects:!0,cacheEncryptionKeys:!0}}},o=0;o<e.length;o++){var d=e[o];document.createElement("div");d.setAttribute("controls","true");["videojs","vjs-7","vjs-default-skin","vjs-big-play-centered","vjs-16-9"].forEach(function(e){d.classList.add(e)}),videojs(d,i,function(){n.push(this),player=this,"function"==typeof __tnt.video.advertising&&__tnt.video.advertising(player),(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0||navigator.userAgent.indexOf("Edge/"))&&(document.getElementById(player.id()).style["padding-top"]="56.25%"),__tnt.video.callback(player),player.trigger("loadstart"),canAutoplay.video({inline:!0}).then(function(e){var t=document.getElementsByTagName("body")[0],n=d.id;n=n.replace("_html5_api","");var i=document.getElementById(n),o=n.replace("video-player-",""),a=t.classList.contains("blox-asset"),r=t.classList.contains("uuid-"+o),l=i.closest("#asset-video-primary"),s=i.closest(".tnt-media-autoplay");if(null!=e.error&&console.log(e.error),!0===e.result&&(a&&(r||l)||s))try{var _=new IntersectionObserver(function(e){e[0].intersectionRatio<=0||(__tnt.video.blox.players[n].playing||__tnt.video.blox.players[player.id()].endcardDisplayed?__tnt.video.blox.players[player.id()].endcardDisplayed&&_.disconnect():__tnt.video.blox.players[n].played?_.disconnect():videojs(n).play())});_.observe(document.getElementById(n))}catch(e){console.log(e)}})})}"function"==typeof t&&t(n)},__tnt.video.legacy_no_template_support=function(){var e=document.querySelectorAll("video.tnt-video,audio.tnt-audio");if(e.length)for(var t=0;t<e.length;t++)e[t].closest("template")||__tnt.video.handleTags(e[t].parentElement.querySelectorAll("video.tnt-video,audio.tnt-audio"))},document.addEventListener("tntVideoReady",function(e){null==videojs.browser.IE_VERSION?__tnt.video.handleTags(document.querySelectorAll("video.tnt-video,audio.tnt-audio,video-js.tnt-video")):__tnt.video.legacy_no_template_support()}),document.addEventListener("DOMContentLoaded",function(e){setTimeout(function(){__tnt.video.vast||document.dispatchEvent(videoReady)},2500)});
//# sourceMappingURL=tnt.video.7.ccfix.5d6568dbfb4f4985ed5b0da8d78a4cf1.js.map