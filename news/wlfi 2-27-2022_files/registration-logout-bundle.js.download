(window.webpackJsonp_spotim_registration=window.webpackJsonp_spotim_registration||[]).push([[26],{28:function(t,e,n){"use strict";n.d(e,"f",(function(){return c})),n.d(e,"g",(function(){return a})),n.d(e,"e",(function(){return i})),n.d(e,"h",(function(){return u})),n.d(e,"d",(function(){return s})),n.d(e,"c",(function(){return d})),n.d(e,"b",(function(){return f})),n.d(e,"a",(function(){return p}));var r=n(50),o=n.n(r);function c(){return document.body.clientWidth<480}var a=c(),i="object"===("undefined"==typeof window?"undefined":o()(window))&&/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent),u=function(t){return t.replace(/-./g,(function(t){return t.toUpperCase()[1]}))};function s(t){switch(t){case"fields.email.errors.invalid":return 1;default:return}}var d=function(t){return btoa(unescape(encodeURIComponent(t)))},f=function(t){return decodeURIComponent(escape(window.atob(t)))},p=function(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}},30:function(t,e,n){"use strict";n.r(e),n.d(e,"LoginMethod",(function(){return r}));var r,o=n(23),c=n.n(o),a=n(24),i=n.n(a),u=n(13),s=n.n(u),d=n(17),f=n.n(d),p=n(4),l=n(26),g=n(18),b=n(3),O=n(5),m=n(28);!function(t){t.SSO="sso",t.LOGIN="login",t.SIGNUP="signup"}(r||(r={}));var w=function(){var t=i()(c.a.mark((function t(e,n){var r,o,a,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.getAsyncUser();case 2:if(r=t.sent,t.prev=3,!b.j&&!b.m){t.next=10;break}return t.next=7,f()("v1.0.0/authentication/current-user",{method:"POST",headers:{"x-spot-id":b.t,"x-real-user-mode":"true"}});case 7:o=t.sent,t.next=13;break;case 10:return t.next=12,Object(l.default)("me/login",{method:"POST",body:JSON.stringify({spot_id:b.t})});case 12:o=t.sent;case 13:return(a=Object(u.parseUser)(o)).isRegistered&&n&&(O.a.send("login_success"),Object(p.dispatchSpotimEvent)("spot-im-post-login",{currentUser:{email:a.email||"",username:a.username||""}}),Object(g.trackEvent)({source:"conversation",spot_id:b.t,post_id:b.o,type:"user-identified",native:n,target_type:r.id,is_registered:!0,segment:Object(p.getLocation)().origin,user_id:a.id}),e&&(i=Object(m.c)(JSON.stringify({userId:a.id,displayName:a.displayName,imageId:a.imageId,social:e})),localStorage.setItem(b.a,i))),t.abrupt("return",a);case 18:throw t.prev=18,t.t0=t.catch(3),O.a.error("login",t.t0),new Error("Login failed due to with error: ".concat(t.t0));case 22:case"end":return t.stop()}}),t,null,[[3,18]])})));return function(e,n){return t.apply(this,arguments)}}();e.default=w},31:function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var r=n(23),o=n.n(r),c=n(24),a=n.n(c),i=n(13),u=n.n(i),s=n(3),d=function(){var t=a()(o.a.mark((function t(e){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){return setTimeout((function(){u.a.set(e),t()}),s.r)}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},34:function(t,e,n){"use strict";var r=n(23),o=n.n(r),c=n(24),a=n.n(c),i=n(13),u=n.n(i),s=n(26),d=n(3);e.a=a()(o.a.mark((function t(){var e,n,r,c,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.getAsyncToken();case 2:return e=t.sent,n=e.networkId,t.next=6,Object(s.default)("me/network-token/".concat(n),{method:"POST",body:JSON.stringify({spot_id:d.t})});case 6:return r=t.sent,c=r.network_id,a=r.token,u.a.setToken(a,c),t.abrupt("return",{token:a});case 11:case"end":return t.stop()}}),t)})))},35:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(4),o=null;function c(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(e=console).log.apply(e,["%cSpot.IM ".concat(t),"background: #307fe2; color: white;"].concat(r))}function a(t){var e=function(){try{if(null===o){var t=new URLSearchParams(Object(r.getLocation)().search);if((o=t.get("SPOTIM_DEBUG_API".toLowerCase()))||(o=window.SPOTIM_DEBUG_API),!o)try{o=window.localStorage.getItem("SPOTIM_DEBUG_API")}catch(t){}o||(o=""),o=o.split(",").map((function(t){return t.toLowerCase()}))}return o}catch(t){return[]}}();return e.indexOf("*")>-1||e.indexOf(t.toLowerCase())>-1?c.bind(null,t):function(){}}},41:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"b",(function(){return u}));var r=n(5),o=n(35),c=Object(o.a)("TTH"),a=function(t){var e;try{e=localStorage.getItem("OWֹֹ_EXTERNAL_USER_ID")||""}catch(t){var n="TTH - cannot get ".concat("OWֹֹ_EXTERNAL_USER_ID"," from local storage: ").concat(t);c(n),r.a.error("startTTH",n)}return String(t)!==String(e)},i=function(t){try{localStorage.setItem("OWֹֹ_EXTERNAL_USER_ID",t)}catch(t){var e="TTH - cannot set ".concat("OWֹֹ_EXTERNAL_USER_ID"," in local storage: ").concat(t);c(e),r.a.error("startTTH",e)}},u=function(){try{localStorage.removeItem("OWֹֹ_EXTERNAL_USER_ID")}catch(e){var t="TTH - cannot set ".concat("OWֹֹ_EXTERNAL_USER_ID"," in local storage: ").concat(e);c(t),r.a.error("startTTH",t)}}},65:function(t,e,n){"use strict";n.r(e);var r=n(23),o=n.n(r),c=n(7),a=n.n(c),i=n(24),u=n.n(i),s=n(13),d=n.n(s),f=n(17),p=n.n(f),l=n(26),g=n(18),b=n(3),O=n(5),m=n(31),w=n(34),v=n(30),_=n(41),h=n(35);function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function S(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach((function(e){a()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var j=Object(h.a)("Registration"),T=function(){var t=u()(o.a.mark((function t(e){var n,r,c,a,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.source,t.prev=1,j("Logout started"),t.next=5,d.a.getAsyncUser();case 5:if(r=t.sent,r.isRegistered){t.next=9;break}return t.abrupt("return",r);case 9:if(!b.j){t.next=16;break}return t.next=12,p()("v1.0.0/authentication/logout",{method:"POST",headers:{"x-spot-id":b.t}});case 12:c=t.sent,r=Object(s.parseUser)(c),t.next=26;break;case 16:return t.next=18,Object(l.default)("me/logout",{method:"POST",body:JSON.stringify({spot_id:b.t})});case 18:return t.next=20,Object(w.a)();case 20:return a=t.sent,i=a.token,d.a.setToken(i),t.next=25,Object(v.default)();case 25:r=t.sent;case 26:return Object(_.b)(),t.next=29,Object(m.a)(S(S({},r),{},{isSuperAdmin:!1}));case 29:return j("Logout succeed, new current user is: ",r),Object(g.trackEvent)({source:n,spot_id:b.t,post_id:b.o,type:"logout-clicked",item_type:"logout",segment:"success"}),t.abrupt("return",r);case 34:return t.prev=34,t.t0=t.catch(1),O.a.error("logout",t.t0),j("Logout failed with: ",t.t0),Object(g.trackEvent)({source:n,spot_id:b.t,post_id:b.o,type:"logout-clicked",item_type:"logout",segment:"error"}),t.abrupt("return",new Error("Logout failed due to with error: ".concat(t.t0)));case 40:case"end":return t.stop()}}),t,null,[[1,34]])})));return function(e){return t.apply(this,arguments)}}();e.default=T}}]);
//# sourceMappingURL=registration-logout-bundle.js.map